{% extends 'skeleton.html' %}
{% load i18n %}
{% block title %}{% translate "Profile" %}{% endblock %} 
{% block content %}
    <body>
        <div class="row d-flex">
            <div class="column">
                <h1>{% translate "Your Profile" %}</h1>
            </div>
        </div>
        {% if user.profile.profile_pic.exists %}
            <div class="row d-flex">
                <img src="{{ user.profile.profile_pic }}">
            </div>
        {% else %}
            <div class="row d-flex">
                <button><a href="#">{% translate "Add Photo" %}</a></button>
            </div>
        {% endif %}
        <div class="row d-flex">
            {% if user.first_name.exists %}
                {% if user.last_name.exists %}
                    <p>{% translate "Name: " %}{{ first_name }}{{ last_name }}</p>
                {% endif %}
            {% endif %}
        </div>
        <div class="row d-flex">
            <p>{% translate "Username: @" %}{{ user.username }}</p>
        </div>
        <h2>{% translate "Biography" %}</h2>
        {% if user.profile.bio.exists %}
            <div class="row d-flex">
                <div class="column">
                    <p>{{ user.profile.bio }}</p>
                </div>
                <div class="column">
                    <button><a href="#">{% translate "Edit Bio" %}</a></button>
                </div>
            </div>
        {% else %}
            <div class="row d-flex">
                <div class="column">
                    <p><i>{% translate "Waiting for a bio..." %}</i></p>
                </div>
                <div class="column">
                    <button><a href="#">{% translate "Add Bio" %}</a></button>
                </div>
            </div>
        {% endif %}     
        {% if is_coach %}
            <h2>{% translate "Teams Coached By You" %}</h2>
            <div class="container">
                <ul>
                    {% for team in coached_teams %}
                        <li><a href="{% url 'competitions:team' team.id %}">{{ team.name }} {% translate "From " %} {{ team.organization.name }}</a></li>
                    {% endfor %}
                </ul>
            </div>
            <!-- <div section="team-records">
                <h2>{% translate "Team Records" %}</h2>
                {{ team_names|json_script:"team_names" }}
                {{ team_wins|json_script:"team_wins" }}
                {{ team_losses|json_script:"team_losses" }}
                <div>
                    <canvas id="pieChartID" width="600" height="400"></canvas>
                    </div>
                    <script src="https:///cdn.jsdelivr.net/npm/chart.js"></script>
                    <script>
                        const team_names = JSON.parse(document.getElementById("team_names").textContent)
                        const team_wins = JSON.parse(document.getElementById("tournament_names").textContent)
                        const team_losses = JSON.parse(document.getElementById("tournament_scorings").textContent)
                        new Chart("teamRecordsChart", {
                        type: "pie",
                        data: {
                            labels: xValues,
                            datasets: [{
                            backgroundColor: barColors,
                            data: yValues
                            }]
                        },
                        options: {
                            title: {
                            display: true,
                            text: "Team Records"
                            }
                        }
                        });
                        
                        
                        var context = document.getElementById("stackedChartID").getContext("2d");
                        var chart = new Chart(context, {
                            type: 'bar',
                            data: {  
                                labels: team_names,
                                datasets: [{
                                    {% for tournament_name, scores in tournament_scorings.items %}
                                        label: tournament_name,
                                        data: scores,
                                    }
                                    {% endfor%}
                                }],
                            },
                            options: {
                                plugins: {
                                    title: {
                                        display: true,
                                    },
                                    scales: {
                                        x: {
                                            stacked: true,
                                        },
                                        y: {
                                            stacked: true,
                                        }
                                    }
                                }
                            }
                        });
                    </script>
            </div> -->
            <h2>{% translate "Team Rankings" %}</h2>
            <div class="container">
                <ul>
                    {% for ranking in team_rankings %}
                        <li>
                            <div class="container">
                                <h3>{{ ranking.item }} </h3>
                                {% for rank in ranking.value %}
                                    {% if rank.1.is_single_elimination %}
                                        <p>{{ rank.0 }}, <a href="{% url 'comeptitions:single_elimination_tournament' rank.1.id%}">{% translate "See" %}</a></p>
                                    {% else %}
                                        <p>{{ rank.0 }}, <a href="{% url 'competitions:round_robin_tournament' rank.1.id %}">{% translate "See" %}</a></p>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif%}
        {% if is_judge%}
            {% if judged_tournaments %}
                <div class="container">
                    <h3>{% translate "Tournaments That You've Judged" %}</h3>
                    <ul>
                        {% for tournament in judged_tournaments %}
                            <li>
                                <p><a href="#">{% translate "Go" %}</a> {% translate "To" %} {{ tournament.event.name }}</p>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
            {% if upcoming_gigs.exists %}
                <div class="container">
                    <h3>{% translate "Upcoming Judging Gigs" %}</h3>
                    <ul>
                        {% for gig in upcoming_gigs %}
                            <li><p>{{ match }} {% translate "For" %} {{ gig.tournament }}, {{ gig.tournament.competition.name }}</p></li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
            {% if current_gigs.exists %}
                <div class="container">
                    <h3>{% trans "Current Judging Gigs" %}</h3>
                    <ul>
                        {% for gig in current_gigs %}
                            <li>
                                <p>{{ match }}</p>
                                <a href="#">
                                    <button>{% translate "Submit Scores" %}</button>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        {% endif%}
        {% if watch_competitions %}
            <div class="container">
                <h2>{% translate "Watch Now: Competitions" %}</h2>
                <ul>
                    {% for competition in watch_competitions %}
                        <li>
                            <p><a href="{% url 'competitions:competition' competition.id %}">{{ competition.name }} {% translate "Started At" %} {{ competition.start_date }}</a></p>
                        </li>
                    {% endfor %}
            </div>
        {% endif %}
        {% if watch_tournaments %}
            <div class="container">
                <h2>{% translate "Watch Now: Tournaments" %}</h2>
                <ul>
                {% for tournament in watch_tournaments %}
                    <li>
                        <p><a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }} {% translate "Started At" %} {{ tournament.start_time }}</a></p>
                    </li>
                {% endfor %}
                </ul>
            </div>
        {% endif %}
        {% if newly_ended_competitions %}
            <div class="container">
                <h2>{% translate "Recent Results" %}</h2>
                <ul>
                    {% for competition in newly_ended_competitions %}
                        <li>
                            <p><a href="{% url 'competitions:competition' competition.id %}">{{ competition.name }}</a></p>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </body>
{% endblock %}