{% extends 'skeleton.html' %}
{% load i18n %}
{% block title %}{% translate "Profile" %}{% endblock %} 
{% block content %}
    <body>
        <h1>{% translate "Your Profile" %}</h1>
        <button><a href="#">{% translate "Edit Status" %}</a></button>
        <div class="user-info-section">
            {% if user.profile.profile_pic.exists %}
                <img src="{{ user.profile.profile_pic }}">
            {% else %}
                <button><a href="#">{% translate "Add Photo" %}</a></button>
            {% endif %}
            {% if user.first_name.exists %}
                {% if user.last_name.exists %}
                    <p>{% transalte "Name: " %}{{ first_name }}{{ last_name }}</p>
            <p>{% translate "Username: @"}{% user.username %}</p>
            {% if user.profile.bio.exists %}
                <h2>{% translate "Biography" %}</h2>
                <p>{{ user.profile.bio }}</p>
            {% endif %}
            <button><a href="#">{% translate "Edit Info" %}</a></button>
        </div>
        {% if is_coach %}
            <div section="coach-information">
                <h2>{% translate "Teams Coached By You %}</h2>
                <li>
                    {% for team in coached_teams %}
                        <li><a href="{% competitions:team team.id %}">{{ team.name }} {% translate "From " %} {{ team.organization.name }}</a></li>
                    {% endfor %}
                </li>
            </div>
            <div section="team-records">
                <h2>{% translate "Team Records" %]</h2>
                {{ records|json_script:"team_records" }}
                {{ records|json_script:"team_records" }}
                {{ records|json_script:"team_records" }}
                this needs to be edited for the data
                    <div>
                        <canvas id="stackedChartID" width="600" height="400"></canvas>
                    </div>
                    <script src="https:///cdn.jsdelivr.net/npm/chart.js"></script>
                    <script>
                        const team_names = JSON.parse(document.getElementById("team_names").textContent)
                        const tournament_names = JSON.parse(document.getElementById("tournament_names").textContent)
                        const tournament_scorings = JSON.parse(document.getElementById("tournament_scorings").textContent)
                        new Chart("teamRecordsChart", {
                        type: "pie",
                        data: {
                            labels: xValues,
                            datasets: [{
                            backgroundColor: barColors,
                            data: yValues
                            }]
                        },
                        options: {
                            title: {
                            display: true,
                            text: "Team Records"
                            }
                        }
                        });
                        
                        
                        var context = document.getElementById("stackedChartID").getContext("2d");
                        var chart = new Chart(context, {
                            type: 'bar',
                            data: {  
                                labels: team_names,
                                datasets: [{
                                    {% for tournament_name, scores in tournament_scorings.items %}
                                        label: tournament_name,
                                        data: scores,
                                    }
                                    {% endfor%}
                                }],
                            },
                            options: {
                                plugins: {
                                    title: {
                                        display: true,
                                    },
                                    scales: {
                                        x: {
                                            stacked: true,
                                        },
                                        y: {
                                            stacked: true,
                                        }
                                    }
                                }
                            }
                        });
                    </script>
            </div>
            <div section="upcoming-competitions">
                <h2>{% translate "Team Rankings" %}</h2>
                <ul>
                    {% for ranking in team_rankings %}
                        <li>
                            <div class="container">
                                <h3>{{ ranking.item }} </h3>
                                {% for rank in ranking.value %}
                                    <p>{{ rank.0 }}, <a href="{% urls 'competitions:tournament rank.1.id %}">{% translate "See" %}</a></p>
                                {% endfor %}
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif%}
        {% if is_judge%}
            <h3>{% translate "Tournaments That You've Judged" %}</h3>
            <ul>
                {% for tournament in judged_tournaments %}
                    <li>
                        <p><a href="{{ 'urls:tournament' tournament.id }}">{% translate "Go" %}</a> {% translate "To" %} {{ tournament.event.name }}</p>
                    </li>
                {% endfor %}
            </ul>
            <h3>{% translate "Upcoming Judging Gigs" %}</h3>
            {% if upcoming_gigs.exists %}
                <ul>
                    {% for gig in upcoming_gigs %}
                        <li><p>{{ match }} {% translate "For" %} {{ gig.tournament }}, {{ gig.tournament.competition.name }}</p></li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if current_gigs.exists %}
                <h3>{% trans "Current Judging Gigs" %}</h3>
                <ul>
                    {% for gig in current_gigs %}
                        <li>
                            <p>{{ match }}</p>
                            <a href="#">
                                <button>{% translate "Submit Scores" %}</button>
                            </a>
                        </li>
                    {% endfor %}
                </ul>
        {% endif%}
        <div class="container">
            <div class="container">
                <h2>{% translate "Watch Now" %}</h2>
                <li>
                    {% for competition in watch_competitions %}
                        <li>
                            <p><a href="{% competitions:competition competition.id %}">{{ competition.name }} {% translate "Started At" %} {{ competition.start_date }}</a></p>
                        </li>
                    {% endfor %}
                    {% for tournament in watch_tournaments %}
                    <li>
                        <p><a href="{% competitions:tournament tournament.id %}">{{ tournament.event.name }} {% translate "Started At" %} {{ tournament.start_time }}</a></p>
                    </li>
                    {% endfor %}
                </li>
            </div>
            <div class="container">
                <h2>{% translate "Recent Results" %}</h2>
                <li>
                    {% for competition in newly_ended_competitions %}
                        <li>
                            <p><a href="{% competitions:competition competition.id %}">{{ competition.name }}</a></p>
                        </li>
                    {% endfor %}
                </li>
            </div>
        </div>
    </body>
{% endblock %}