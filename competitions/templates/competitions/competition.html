{% extends 'skeleton.html' %}
{% load i18n %}

{% block title %}{% translate "Competition Page" %}{% endblock %}
{% block content %}
    <header>
        <h1>
            {% if competition.is_judgable %}
            <i class="bi-activity" title="{{ competition.status }}"></i>
            {% elif competition.is_complete %}
            <i class="bi-check2-circle" title="{{ competition.status }}"></i>
            {% elif competition.is_closed %}
            <i class="bi-x-circle" title="{{ competition.status }}"></i>
            {% elif competition.is_in_setup %}
            <i class="bi bi-device-ssd" title="{{ competition.status }}"></i>
            {% endif %}
            {{ competition }}
        </h1>
    </header>
    <div class="row d-flex">
        <a href="{% url 'competitions:results' competition.id %}">See Results</a>
    </div>
    <hr>
    {% if competition.tournament_set.all %}
        <h3>{% translate "Tournaments" %}</h3>
        {% for tournament in competition.tournament_set.all %}
            <div class="row d-flex">
                <div class = "col-12 tournament">
                    {% if competition.is_archived and user.is_staff %}
                        <i class="bi-archive" title="{{ tournament.status }}"></i>
                        {% if tournament.is_single_elimination %}
                            {% translate "Single Elimination Tournament:" %}
                        {% elif tournament.is_round_robin %}
                            {% translate "Preliminary Tournament:" %}
                        {% endif %}
                        <small>{% translate "You can see this archived item because you are signed in as a superuser." %}</small>
                    {% elif tournament.is_in_setup %}
                        <i class="bi bi-device-ssd" title="{{ tournament.status }}"></i> 
                        {% if tournament.is_single_elimination %}
                            {% translate "Single Elimination Tournament:" %}
                        {% elif tournament.is_round_robin %}
                            {% translate "Preliminary Tournament:" %}
                        {% endif %}
                        {% if user.is_staff %} <a href="{% url 'competitions:tournament' tournament.id %}">{{ tournament }}</a>{% else %}{{ tournament }}{% endif %}
                    {% elif tournament.is_judgable or tournament.is_complete or tournament.is_closed %}
                        {% if tournament.is_judgable %} 
                            <i class="bi-activity" title="{{ tournament.status }}"></i>
                        {% elif tournament.is_complete %} 
                            <i class="bi-check2-circle" title="{{ tournament.status }}">
                        {% elif tournament.is_closed %} 
                            <i class="bi-x-circle" title="{{ tournament.status }}"></i>
                        {% endif %}
                        {% if tournament.is_single_elimination %}
                            {% translate "Single Elimination Tournament:" %} 
                        {% elif tournament.is_round_robin %}
                            {% translate "Preliminary Tournament:" %}
                        {% endif %}
                        <a href="{% url 'competitions:tournament' tournament.id %}">{{ tournament }}</a>
                    {% endif %}
                    {% if tournament.points %}
                        ({{ tournament.points|floatformat:"0" }} {% translate "points" %}) 
                    {% endif %}
                    {% if user.is_staff %}
                        <form class="form-inline my-2 my-md-0 justify-content-end d-inline ps-2" action="/tournament/{{ tournament.id }}/?next=competition&id={{ competition.id }}" method="POST" id="status">
                            {% csrf_token %}
                            <div class="input-group d-inline">
                                <select name="status" onchange="this.form.submit();">
                                    {% for value, translated_value in form.status.field.choices %}
                                        <option value="{{ value }}" {% if tournament.status == value %}selected{% endif %}>{{ translated_value }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </form>
                    {% endif %} 
                </div>
            </div>      
        {% endfor %}
    {% endif %}
    {% if competition.teams.exists %}
        <h3>{% translate "Competing Teams" %}</h3>
        {% for team in competition.teams.all %}
            <div class="row d-flex">
                <div class = "col-12">
                    <a href="{% url 'competitions:team' team.id %}">{{ team }}</a>
                </div>
            </div>
        {% endfor %}
    {% endif %}

    {% if user.is_staff %}
        {% comment %} <hr>
        <h3>Change Status</h3>
        <form class="form-inline my-2 my-md-0 justify-content-end d-inline ps-2" action="" method="POST">
            {% csrf_token %}
            <div class="input-group d-inline">
                <select class="form-select" name="status" onchange="this.form.submit();">
                    <option value="SETUP" {% if competition.is_in_setup %}selected{% endif %}>{% translate "SETUP" %}</option>
                    <option value="OPEN" {% if competition.is_judgable %}selected{% endif %}>{% translate "OPEN" %}</option>
                    <option value="COMPLETE" {% if competition.is_complete %}selected{% endif %}>{% translate "COMPLETE" %}</option>
                    <option value="CLOSED" {% if competition.is_closed %}selected{% endif %}>{% translate "CLOSED" %}</option>
                    <option value="ARCHIVED" {% if competition.is_archived %}selected{% endif %}>{% translate "ARCHIVED" %}</option>
                </select>
            </div>
        </form> {% endcomment %}
    {% endif %}

    {% if winner %}
        <hr>
        <h3>{% translate "Winners:" %}</h3>
        {% for team in winner %}
        <div class="row d-flex">
            <div class = "col-12">
                <a href="{% url 'competitions:team' team.id %}">{{ team }}</a>
            </div>
        </div>
        {% endfor %}
    {% endif %}

    {% if user.is_superuser %}
        <hr>
        <a href="{% url "competitions:create_tournament" %}?competition_id={{ competition.id }}" class="btn btn-secondary">{% translate "Create Tournament" %}</a>
        <a href="{% url "competitions:arena_color" competition.id %}" class="btn btn-secondary">{% translate "Change Arena Colors" %}</a>
    {% endif %}
{% endblock %}
<!-- pass in urls for the results page in competitions/ -->
