{% extends 'skeleton.html' %}
{% load i18n %}
{% block stylesheets %}
    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script> 
    <script src= "https://cdn.jsdelivr.net/npm/chart.js@4.0.1/dist/chart.umd.min.js"></script> 
{% endblock %}
{% block title %}{% trans "Results" %}{% endblock %} 
{% block content %}
<body>
    <header>
        <h1>{% trans "Results For " %} {{ competition.name }} {{ competition.start_date }} - {{competition.end_date }}</h1>
        <h2>{% trans "Judged by " %}</h2>
        <ul>
            {% for judge_name in judge_names %}
                <li> {{ judge_name }} </li>
            {% endfor %}
        </ul>
    </header>
    {% if tournaments.exists %}
    {% else %}
        <p>All of the tournaments are currently ongoing and haven't finished yet.</p>
    {% endif %}
    {{ tournament_names|json_script:"tournament_names" }}
    {{ team_names|json_script:"team_names" }}
    {{ team_scorings|json_script:"team_and_scorings" }}
    <script>
        <div>
            <canvas id="stackedChartID" width="600" height="400"></canvas>
        </div>
        const divElem = document.getElementById("divID");
        function randomcolor() {
            return Math.floor(Math.random() * 255);
        }
        divElem.addEventListener('click', () => {
            divElem.style.backgroundColor = 'rgba('
                + randomcolor() + ',' + randomcolor()
                + ',' + randomcolor() + '\)'
        })
        var context = document.getElementById("stackedChartID").getContext("2d");
        var chart = new Chart(context, {
            type: 'bar',
            data: {  
                labels: team_names,
                datasets: tournament_names.map((ts, i)) => ({
                    label: tournament_names[i],
                    backgroundColor: randomColor(),
                    data: team_scorings[i][i]
                }),
            },
            options: {
                plugins: {
                    title: {
                        display: true,
                    },
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                        }
                    }
                }
            }
        });
    </script>
    <div class="stats-section">
        <h2>{% trans "Total Scores For Each Team" %}</h2>
        <ul>
            {% for team_and_score in team_and_score %}
                <li>{{ team_and_score.indexOf(0) }} : {{ team_and_score[1] }} {% trans "points" %}</li>
            {% endfor %}
        </ul>
        
    </div>
</body>
{% endblock %}