{% extends 'skeleton.html' %}
{% load i18n %}
{% block title %} RoboMed Team Page {% endblock %} 
{% block content %}
    <header>
        <h1>Team: {{ team }}</h1>
        {% if team.coach.first_name %}
            {% if team.coach.last_name %}
                <p>Coached by {{ team.coach.first_name }} {{ team.coach.last_name }}</p>
            {% else %}
                <p>Coached by @{{ team.coach.username }} </p>
            {% endif %}
        {% else %}
            <p>Coached by @{{ team.coach.username }}</p>
        {% endif %}
        <!-- <p>TEAM LOGO HERE</p> -->
    </header>
    <div class="organization-information">
        <h3>Information About {{ team.organization.name }}</h3>
        <!-- <h4>Address:<i>ADDRESS FIELD HERE</i></h4> -->
        <!-- <p>ORGANIZATION LOGO HERE</p> -->
    </div>
    {% if team.competition_set.all %}
        <div class="match-schedule">
            <h3>Upcoming Matches</h3>
            {% for competition in team.competition_set.all %}
                {% if competition.currently_running and competition.status == "OPEN" %}
                    <div class="row">
                        <h4>{{ competition }}maybe add dates, and order matches</h4>
                        {% for tournament in competition.tournament_set.all %}
                            {% if tournament.status == "OPEN" %}
                                {% for match in tournament.match_set.all %}
                                    <!-- {% load tz %} -->
                                    {% if match.compare_time_and_date %}
                                        {% if match.advancers %}
                                            {{ break }}
                                        {% else %}
                                    <!-- {% if match.currently_running %} -->
                                        <div class="column">
                                            <p>Match {{ match.id }}: {{ match }} with competitors</p>
                                        </div>
                                        <div class="column">
                                            <p>Begins At {{ match.time }}</p>
                                        </div>
                                    {% endif %}  
                                    {% endif %}
                                    {% endif %}  
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
           {% endfor %}
        </div>
    {% endif %}
    {% if team.competed_in_at_least_one_tourney %}
        <div class="past-tournament-set">
        <h3>Past Tournaments</h3>
        <ul>
            {% for tournament in team.tournament_set.all %}
                {% if tournament.status == "COMPLETE" and tournament.team.ranking.rank == 1%}
                    <li style="color:green;"><a href="{% url 'competitions:tournament' tournament.id %}">{{ tournament }}, Win!</a>
                {% endif %}
                {% if tournament.status == "COMPLETE" and tournaments.team.ranking.rank != 1 %}
                    <li><a href="{% url 'competitions:tournament' tournament.id %}">{{ tournament }}</a></li>
                {% endif %}
                {% if tournament.status != "COMPLETE" %}
                    <li>This tournament is unavailable for viewing: <p style="color:red;">{{ tournament }}</p></li>
                {% endif %}
            {% endfor %}
        </ul>
        </div>
    {% endif %}
    {% if team.competed_in_at_least_one_comp %}
        <div class="past-competitions-set">
        <h3>Past Competitions</h3>
        <ul>
            {% for competition in team.competition_set.all %}
                {% if competition.status == "COMPLETE" %}
                    <li><a href="{% url 'competitions:competition' competition.id %}">{{ competition }}</a></li>
                {% else %}
                    <li>This competition is unavailable for viewing: <p style="color:red;"> {{ competition }}</p></li>
                {% endif %}
            {% endfor %}
        </ul>
    {% endif %}  
    {% if team.completed_one_match %}
        <h3>Match History</h3>
        <div class="losses-set"
        {% for normal_match in team.match_set.all %}
            {% for won_match in team.won_matches.all %}
                {% if normal_match != won_match %}

                    {{ losses_list.add(normal_match) }}
                {% endif %}
            {% endfor %}
        {% endfor%}
    {% endif %}
    {% if team.draw_at_least_one_match %}
        <div class="row">
            <h4>Draws</h4>
            <ul>
            {% for match in team.won_matches.all %}
                {% if match.advancers.length > 1 %}
                    <li>{{ match}}</li>
                {% endif %
            {% endfor %}
            </ul>
        </div>
    {% endif %}
    {% if team.won_at_least_one_match %}
    <div class="row">
        <h4>Wins</h4>
        <ul>
            {% for match in team.won_matches.all %}
                {% if match.advancers.length == 1 %}
                    <li>{{ match }}</li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {% if team.lost_at_least_one_match %}
        <div class="row">
            <h4>Losses</h4>
            <ul>
                {% for match in team.match_set.exclude(team.won_matches.all) %}
                    <li>{{ match }}</li>
                {% endfor %}
            </ul>
        </div> 
    {% endif %}      
        
{% endblock %}