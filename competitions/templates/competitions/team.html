{% extends 'skeleton.html' %}
{% load i18n %}
{% block title %}{% translate "Team:" %} {{ team.name }}{% endblock %} 
{% block content %}
    <header>
        <h1>{% translate "Team:" %} {{ team }}</h1>
        {% if team.coach.first_name %}
            {% if team.coach.last_name %}
                <p>{% translate "Coached by" %} {{ team.coach.first_name }} {{ team.coach.last_name }}</p>
            {% else %}
                <p>{% translate "Coached by" %} @{{ team.coach.username }} </p>
            {% endif %}
        {% else %}
            <p>{% translate "Coached by" %} @{{ team.coach.username }}</p>
        {% endif %}
        <p>TEAM LOGO HERE</p>
    </header>
    <div class="organization-information">
        <h3>{% translate "Information About" %} {{team.organization.name}}</h3>
        <h4>{% translate "Address" %}:<i>....</i></h4>
        <!-- There isn't a field for address for organizations yet -->
        <p>logo...</p>
    </div>
    <div class="match-schedule">
        <h3>{% translate "Upcoming Matches" %}</h3>
        {% comment %} all incomplete matches ordered by time... {% endcomment %}
        {% for competition in team.competition_set.all %}
            {% if competition.is_judgable and competition.check_date %}
                {% for tournament in competition.tournament_set.all %}
                    <div class="row">
                        <h4>{{ competition.name }}, {{ tournament.name }}, {{ competition.start_date }} - {{ competition.end_date }} </h4>
                        <h5>{% translate "Your Events" %}</h5>
                        {% for event in tournament.event_set.all %}
                            <div class="column">
                                <p>{{ event.name }}</p>
                            </div>
                            <div class="column">
                                {% for match in event.match_set.all.ordering %}
                                    {% if match.check_time %}
                                        {% if match.advancers %}
                                            {{ break }}
                                        {% else %}
                                            <p>{% translate "Match" %} {{ match.id }}: {% translate "Between" %} {{ match }}, {% translate "Begins At" %} {{ match.time }}</p>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            {% endif %}
        {% empty %}
            <p>{% translate "No upcoming matches!" %}</p>
        {% endfor %}
    </div> 
    <div class="competition-set">
        <h3>{% translate "Competitions participated in" %}</h3>
        {% for competition in team.competition_set.all %}
            <div class="row d-flex">
                {% if not competition.is_archived %}
                    <div class = "col-12 competition">
                        {% if competition.is_judgable %}
                            <i class="bi-activity"></i> <a href="{% url 'competitions:competition' competition.id %}">{{ competition }}</a>
                        {% elif competition.is_complete %}
                            <i class="bi-check2-circle"></i> <a href="{% url 'competitions:competition' competition.id %}">{{ competition }}</a>
                        {% elif competition.is_closed %}
                            <i class="bi-x-circle"></i> <a href="{% url 'competitions:competition' competition.id %}">{{ competition }}</a>
                        {% elif competition.is_in_setup %}
                            <i class="bi-gear"></i> {{ competition }}
                        {% endif %}
                        {% if user.is_staff %}
                            <form class="form-inline my-2 my-md-0 justify-content-end" action="/competition/{{ competition.id }}/?next=team&id={{ team.id }}" method="POST" id="status">
                                {% csrf_token %}
                                <div class="input-group">
                                    <select name="status" onchange="this.form.submit();">
                                        <option value="SETUP" {% if competition.is_in_setup %}selected{% endif %}>SETUP</option>
                                        <option value="OPEN" {% if competition.is_judgable %}selected{% endif %}>OPEN</option>
                                        <option value="COMPLETE" {% if competition.is_complete %}selected{% endif %}>COMPLETE</option>
                                        <option value="CLOSED" {% if competition.is_closed %}selected{% endif %}>CLOSED</option>
                                        <option value="ARCHIVED" {% if competition.is_archived %}selected{% endif %}>ARCHIVED</option>
                                    </select>
                                </div>
                            </form>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    <div class="tournament-set">
        <h3>{% translate "Tournaments Won" %}</h3>
        <ul>
            {% for tournament in team.tournament_set.all %}
                <li>
                    <div class="row d-flex">
                        {% if not tournament.is_archived %}
                            <div class = "col-12 tournament">
                                {% if tournament.is_judgable %} 
                                    <p><i class="bi-activity"></i> <a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }}</a></p>
                                {% elif tournament.is_complete %} 
                                    <p><i class="bi-check2-circle"></i> <a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }}</a></p>
                                {% elif tournament.is_closed %} 
                                    <p><i class="bi-x-circle"></i> <a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }}</a></p>
                                {% elif tournament.is_in_setup %}
                                    <p><i class="bi-gear"></i> {{ tournament }}</p>
                                {% endif %}  
                                {% if user.is_staff %}
                                    <form class="form-inline my-2 my-md-0 justify-content-end" action="/tournament/{{ tournament.id }}/" method="POST" id="status">
                                        {% csrf_token %}
                                        <div class="input-group">
                                            <select name="status" onchange="this.form.submit();">
                                                <option value="SETUP" {% if tournament.is_in_setup %}selected{% endif %}>SETUP</option>
                                                <option value="OPEN" {% if tournament.is_judgable %}selected{% endif %}>OPEN</option>
                                                <option value="COMPLETE" {% if tournament.is_complete %}selected{% endif %}>COMPLETE</option>
                                                <option value="CLOSED" {% if tournament.is_closed %}selected{% endif %}>CLOSED</option>
                                                <option value="ARCHIVED" {% if tournament.is_archived %}selected{% endif %}>ARCHIVED</option>
                                            </select>
                                        </div>
                                    </form>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
    <div class="match-records">
        <h3>{% translate "Match History" %}</h3>
        <div class="row">
            <h4>{% translate "Wins" %}</h4>
            <ul>
                {% for match in team.won_matches.all %}  
                    {% if match.advancers.length == 1 %}
                        <li>{% translate "Tournament:" %} <a href="{% url 'competitions:tournament' match.tournament.id %}">{{ match.tournament.name }}</a>, {% translate "Event:" %} {{ match.event.name }}, {% translate "Players:" %}
                            {% for player in match.event.player_set.all %} 
                                {{ player.first_name }},
                            {% endfor %}
                            {% translate "Score:" %} {{ match.awarded_points }}</li>
                    {% endif %}
                {% empty %}
                    <p>{% translate "No wins!" %}</p>
                {% endfor %}
            </ul>
        </div>
        <div class="row">
            <h4>{% translate "Losses" %}</h4>
        </div>
        <div class="row">
            <h4>{% translate "Draws" %}</h4>
        </div>
    </div>
{% endblock %}