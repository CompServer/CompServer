{% extends 'skeleton.html' %}
{% load i18n %}
{% block title %}Team: {{ team.name }}{% endblock %} 
{% block content %}
    <header>
        <h1>{% trans "Team:" %} {{ team }}</h1>
        {% if team.coach.first_name %}
            {% if team.coach.last_name %}
                <p>{% trans "Coached by" %} {{ team.coach.first_name }} {{ team.coach.last_name }}</p>
            {% else %}
                <p>{% trans "Coached by" %} @{{ team.coach.username }} </p>
            {% endif %}
        {% else %}
            <p>{% trans "Coached by" %} @{{ team.coach.username }}</p>
        {% endif %}
    </header>
    <div class="organization-information">
        <h3>{% trans "Information About" %} {{team.organization.name}}</h3>
        <h4>{% trans "Address" %}:<i>....</i></h4>
        <h3>{% trans "Information About" %} {{ team.organization.name }}</h3>
    </div>
    {% if team.competition_set.all %}
        <div class="match-schedule">
            <h3>{% trans "Upcoming Matches" %}</h3>
            {% comment %} all incomplete matches ordered by time... {% endcomment %}
            {% for competition in team.competition_set.all %}
                {% if competition.is_judgable and competition.currently_running %}
                    {% for tournament in competition.tournament_set.all %}
                        <div class="row">
                            <h4>{{ competition.name }}, {{ tournament.name }}, {{ competition.start_date }} - {{ competition.end_date }} </h4>
                            <div class="column">
                                {% for match in tournament.match_set.all %}
                                    {% if match.currently_running %}
                                        {% if match.advancers.exists %}
                                            {{ continue }}
                                        {% else %}
                                            <p>{% trans "Match" %} {{ match.id }}: {% trans "Between" %} {{ match }}, {% trans "Begins At" %} {{ match.time }}</p>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
    {% if team.competition_set.all %}
        <div class="match-schedule">
            <h3>Upcoming Matches</h3>
            {% for competition in team.competition_set.all %}
                {% if competition.currently_running and competition.is_judgable %}
                    <div class="row">
                        <h4>{{ competition }}maybe add dates, and order matches</h4>
                        {% for tournament in competition.tournament_set.all %}
                            {% if tournament.is_judgable %}
                                {% for match in tournament.match_set.all %}
                                    <!-- {% load tz %} -->
                                    {% if match.compare_time_and_date %}
                                        {% if match.advancers.exists %}
                                            {{ continue }}
                                        {% else %}
                                    <!-- {% if match.currently_running %} -->
                                        <div class="column">
                                            <p>Match {{ match.id }}: {{ match }} with competitors</p>
                                        </div>
                                        <div class="column">
                                            <p>Begins At {{ match.time }}</p>
                                        </div>
                                    {% endif %}  
                                    {% endif %}
                                    {% endif %}  
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
           {% endfor %}
        </div>
    {% endif %}
    {% if team.competed_in_at_least_one_comp %}
        <div class="past-competitions-set">
            <h3>{% trans "Past Competitions" %}</h3>
            <ul>
                {% for competition in team.competition_set.all %}
                    <li>
                        <div class="row d-flex">
                            <div class = "col-12">
                                {% if competition.is_judgable %}
                                    <p><i class="bi-activity"></i> <a href="{% url 'competitions:competition' competition.id %}">{{ competition }}</a></p>
                                {% elif competition.is_complete %}
                                    <p><i class="bi-check2-circle"></i> <a href="{% url 'competitions:competition' competition.id %}">{{ competition }}</a></p>
                                {% elif competition.is_closed %}
                                    <p><i class="bi-x-circle"></i> <a href="{% url 'competitions:competition' competition.id %}">{{ competition }}</a></p>
                                {% elif competition.is_in_setup %}
                                    <p><i class="bi-gear"></i> {{ competition }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}  
    {% if team.won_at_least_one_tourney %}
        <div class="won-tournaments-set">
            <h3>{% trans "Tournaments Won" %}</h3>
            <ul>
                {% for tournament in team.tournament_set.all %}
                    <li>
                        <div class="row d-flex">
                            <div class = "col-12">
                                {% if tournament.is_complete and team in tournament.advancers.all %} 
                                    <p><i class="bi-check2-circle"></i> <a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }}</a></p>
                                {% elif tournament.is_closed and team in tournament.advancers.all %} 
                                    <p><i class="bi-x-circle"></i> <a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }}</a></p>
                                {% endif %}  
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
    {% if team.competed_in_at_least_one_tourney %}
        <div class="past-tournament-set">
            <h3>{% trans "Past Tournaments" %}</h3>
            <ul>
                {% for tournament in team.tournament_set.all %}
                    <li>
                        <div class="row d-flex">
                            <div class = "col-12">
                                {% if tournament.is_judgable %} 
                                    <p><i class="bi-activity"></i> <a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }}</a></p>
                                {% elif tournament.is_complete and team not in tournament.advancers.all %} 
                                    <p><i class="bi-check2-circle"></i> <a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }}</a></p>
                                {% elif tournament.is_closed and team not in tournament.advancers.all %} 
                                    <p><i class="bi-x-circle"></i> <a href="{% url 'competitions:single_elimination_tournament' tournament.id %}">{{ tournament.event.name }}</a></p>
                                {% elif tournament.is_in_setup %}
                                    <p><i class="bi-gear"></i> {{ tournament }}</p>
                                {% endif %}  
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
    {% if team.has_a_match_record %}
        <div class="match-record">
            {% if team.lost_at_least_one_match %}
                <div class="row">
                    <h4>{% trans "Wins Against Other Teams" %}</h4>
                    <ul>
                        {% for match in team.won_matches.all %}  
                            {% if match.advancers.length == 1 %}
                                <li>{{ match }}</li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
            {% if team.lost_at_least_one_match %}
                <div class="row">
                    <h4>{% trans "Losses Against Other Teams" %}</h4>
                    <ul>
                        {% for match in team.match_set.all %}
                            {% if match not in team.won_matches.all %}
                                <li>{{ match }}</li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div> 
            {% endif %}      
            {% if team.draw_at_least_one_match %}
                <div class="row">
                    <h4>{% trans "Draws With Other Teams" %}</h4>
                    <ul>
                        {% for match in team.won_matches.all %}
                            {% if match.advancers.length > 1 %}
                                <li>{{ match }}</li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}